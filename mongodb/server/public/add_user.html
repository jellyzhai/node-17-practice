<!DOCTYPE html>
<html>

<head>
    <title>添加用户</title>
    <script src="https://unpkg.com/axios@1.1.2/dist/axios.min.js"></script>
    <script>
        axios.interceptors.request.use(
            function (config) {
                const token = localStorage.getItem("authorization");

                if (token) {
                    config.headers.authorization = token;
                }

                return config;
            },
            function (error) {
                return Promise.reject(error);
            }
        );
    </script>
</head>

<body>
    <h2>
        <button id="logout">退出</button>

        <script>
            const logoutDom = document.querySelector('#logout')

            logoutDom.onclick = () => {
                localStorage.removeItem('authorization')
                alert('退出成功！')
                location.assign('/user_list.html')
            }
        </script>
    </h2>
    <h2>添加用户</h2>

    <div>
        <div>用户名：<input type="text" id="username" /></div>
        <div>密码：<input type="password" id="password" /></div>
        <div>年龄：<input type="number" id="age" /></div>
        <div><button id="add">添加用户</button></div>
    </div>

    <script>
        const usernameDom = document.querySelector("#username");
        const passwordDom = document.querySelector("#password");
        const ageDom = document.querySelector("#age");
        const addUserDom = document.querySelector("#add");

        addUserDom.onclick = () => {
            axios
                .post("/api/user", {
                    username: usernameDom.value,
                    password: passwordDom.value,
                    age: ageDom.value,
                })
                .then((res) => {
                    if (res.data.ok === 1) {
                        location.assign("/user_list.html");
                    } else if (res.data.ok === 401) {
                        alert("登录状态已失效，请重新登录");
                        location.assign("/login");
                    }
                })
                .catch((err) => {
                    if (+err.response.status === 401) {
                        alert("登录状态已失效，请重新登录");
                        location.assign("/login");
                    } else {
                        alert('添加用户失败')
                    }
                });
        };
    </script>
</body>

</html>